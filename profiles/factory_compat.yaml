# Factory-Compatible Agent Readiness Profile
# Evaluates repositories against the 9 Pillars / 5 Levels model

name: factory_compat
version: "1.0.0"
description: >
  Default profile for evaluating repository maturity for AI agent readiness.
  Based on the 9 Pillars model with 5 maturity levels (L1-L5).

checks:
  # =============================================================================
  # PILLAR: Documentation (docs)
  # =============================================================================

  - id: docs.readme
    name: README exists
    description: Repository has a README file
    type: any_of
    pillar: docs
    level: L1
    required: true
    checks:
      - id: docs.readme_upper
        type: file_exists
        name: README.md (uppercase)
        pillar: docs
        level: L1
        required: false
        path: README.md
      - id: docs.readme_mixed
        type: file_exists
        name: Readme.md (mixed case)
        pillar: docs
        level: L1
        required: false
        path: Readme.md
      - id: docs.readme_lower
        type: file_exists
        name: readme.md (lowercase)
        pillar: docs
        level: L1
        required: false
        path: readme.md
      - id: docs.readme_rst
        type: file_exists
        name: README.rst (reStructuredText)
        pillar: docs
        level: L1
        required: false
        path: README.rst

  - id: docs.readme_sections
    name: README has essential sections
    description: README contains getting started, installation, and usage info
    type: any_of
    pillar: docs
    level: L2
    required: false
    checks:
      - id: docs.readme_sections_upper
        type: file_exists
        name: README.md sections
        pillar: docs
        level: L2
        required: false
        path: README.md
        content_regex: "(installation|getting started|usage|quick start)"
        case_sensitive: false
      - id: docs.readme_sections_mixed
        type: file_exists
        name: Readme.md sections
        pillar: docs
        level: L2
        required: false
        path: Readme.md
        content_regex: "(installation|getting started|usage|quick start)"
        case_sensitive: false
      - id: docs.readme_sections_lower
        type: file_exists
        name: readme.md sections
        pillar: docs
        level: L2
        required: false
        path: readme.md
        content_regex: "(installation|getting started|usage|quick start)"
        case_sensitive: false

  - id: docs.contributing
    name: Contributing guide
    description: Repository has contributing guidelines
    type: any_of
    pillar: docs
    level: L2
    required: false
    checks:
      - id: docs.contributing_md
        type: file_exists
        name: CONTRIBUTING.md
        pillar: docs
        level: L2
        required: false
        path: CONTRIBUTING.md
      - id: docs.contributing_rst
        type: file_exists
        name: CONTRIBUTING.rst
        pillar: docs
        level: L2
        required: false
        path: CONTRIBUTING.rst
      - id: docs.contributing_docs
        type: file_exists
        name: docs/contributing.rst
        pillar: docs
        level: L2
        required: false
        path: docs/contributing.rst
      - id: docs.contributing_docs_md
        type: file_exists
        name: docs/contributing.md
        pillar: docs
        level: L2
        required: false
        path: docs/contributing.md
      - id: docs.contributing_docs_dir
        type: path_glob
        name: Contributing in docs directory
        pillar: docs
        level: L2
        required: false
        pattern: "docs/**/contributing*"
        min_matches: 1

  - id: docs.agents_md
    name: AGENTS.md exists
    description: Repository has agent instructions file (recommended for AI readiness)
    type: any_of
    pillar: docs
    level: L2
    required: false
    checks:
      - id: docs.agents_md.standard
        name: Standard AGENTS.md
        description: AGENTS.md in root
        type: file_exists
        pillar: docs
        level: L2
        required: false
        path: AGENTS.md
      - id: docs.agents_md.claude
        name: Claude AGENTS.md
        description: CLAUDE.md (alias for AGENTS.md)
        type: file_exists
        pillar: docs
        level: L2
        required: false
        path: CLAUDE.md

  - id: docs.changelog
    name: Changelog exists
    description: Repository maintains a changelog
    type: any_of
    pillar: docs
    level: L3
    required: false
    checks:
      - id: docs.changelog.standard
        name: Standard CHANGELOG
        type: file_exists
        pillar: docs
        level: L3
        required: false
        path: CHANGELOG.md
      - id: docs.changelog.history
        name: HISTORY.md
        type: file_exists
        pillar: docs
        level: L3
        required: false
        path: HISTORY.md
      - id: docs.changelog.changes
        name: CHANGES.md
        type: file_exists
        pillar: docs
        level: L3
        required: false
        path: CHANGES.md
      - id: docs.changelog.changes_rst
        name: CHANGES.rst
        type: file_exists
        pillar: docs
        level: L3
        required: false
        path: CHANGES.rst

  # =============================================================================
  # PILLAR: Code Style (style)
  # =============================================================================

  - id: style.editorconfig
    name: EditorConfig
    description: EditorConfig file for consistent formatting
    type: file_exists
    pillar: style
    level: L1
    required: false
    path: .editorconfig

  - id: style.linter_config
    name: Linter configuration
    description: Linter/formatter config exists (ESLint, Ruff, golangci-lint, etc.)
    type: any_of
    pillar: style
    level: L2
    required: false
    checks:
      - id: style.eslint
        type: path_glob
        name: ESLint config
        pillar: style
        level: L2
        required: false
        pattern: ".eslint*"
      - id: style.prettier
        type: path_glob
        name: Prettier config
        pillar: style
        level: L2
        required: false
        pattern: ".prettier*"
      - id: style.biome
        type: file_exists
        name: Biome config
        pillar: style
        level: L2
        required: false
        path: biome.json
      - id: style.ruff
        type: file_exists
        name: Ruff config (Python)
        pillar: style
        level: L2
        required: false
        path: ruff.toml
      - id: style.pyproject_ruff
        type: file_exists
        name: pyproject.toml (may contain ruff/black config)
        pillar: style
        level: L2
        required: false
        path: pyproject.toml
        content_regex: "(ruff|black|flake8|pylint)"
      - id: style.golangci
        type: file_exists
        name: golangci-lint config
        pillar: style
        level: L2
        required: false
        path: .golangci.yml
      - id: style.rustfmt
        type: file_exists
        name: rustfmt config
        pillar: style
        level: L2
        required: false
        path: rustfmt.toml
      - id: style.clippy
        type: file_exists
        name: clippy config
        pillar: style
        level: L2
        required: false
        path: clippy.toml

  - id: style.type_checking
    name: Type checking configuration
    description: Type checking config (TypeScript, mypy, etc.)
    type: any_of
    pillar: style
    level: L2
    required: false
    checks:
      - id: style.typescript
        type: file_exists
        name: TypeScript config
        pillar: style
        level: L2
        required: false
        path: tsconfig.json
      - id: style.mypy
        type: file_exists
        name: mypy config (Python)
        pillar: style
        level: L2
        required: false
        path: mypy.ini
      - id: style.pyproject_mypy
        type: file_exists
        name: pyproject.toml with mypy
        pillar: style
        level: L2
        required: false
        path: pyproject.toml
        content_regex: "(mypy|pyright)"
      - id: style.pyrightconfig
        type: file_exists
        name: Pyright config
        pillar: style
        level: L2
        required: false
        path: pyrightconfig.json

  - id: style.precommit_hooks
    name: Pre-commit hooks
    description: Pre-commit hooks configured for code quality
    type: any_of
    pillar: style
    level: L2
    required: false
    checks:
      - id: style.husky
        type: path_glob
        name: Husky hooks
        pillar: style
        level: L2
        required: false
        pattern: ".husky/*"
      - id: style.precommit_config
        type: file_exists
        name: Pre-commit config
        pillar: style
        level: L2
        required: false
        path: .pre-commit-config.yaml
      - id: style.lefthook
        type: file_exists
        name: Lefthook config
        pillar: style
        level: L2
        required: false
        path: lefthook.yml

  # =============================================================================
  # PILLAR: Build System (build)
  # =============================================================================

  - id: build.package_manifest
    name: Package manifest
    description: Package manifest exists (package.json, pyproject.toml, go.mod, Cargo.toml, etc.)
    type: any_of
    pillar: build
    level: L1
    required: true
    checks:
      - id: build.package_json
        type: file_exists
        name: package.json (Node.js)
        pillar: build
        level: L1
        required: false
        path: package.json
      - id: build.pyproject_toml
        type: file_exists
        name: pyproject.toml (Python)
        pillar: build
        level: L1
        required: false
        path: pyproject.toml
      - id: build.setup_py
        type: file_exists
        name: setup.py (Python)
        pillar: build
        level: L1
        required: false
        path: setup.py
      - id: build.go_mod
        type: file_exists
        name: go.mod (Go)
        pillar: build
        level: L1
        required: false
        path: go.mod
      - id: build.cargo_toml
        type: file_exists
        name: Cargo.toml (Rust)
        pillar: build
        level: L1
        required: false
        path: Cargo.toml
      - id: build.pom_xml
        type: file_exists
        name: pom.xml (Java/Maven)
        pillar: build
        level: L1
        required: false
        path: pom.xml
      - id: build.build_gradle
        type: file_exists
        name: build.gradle (Java/Gradle)
        pillar: build
        level: L1
        required: false
        path: build.gradle
      - id: build.gemfile
        type: file_exists
        name: Gemfile (Ruby)
        pillar: build
        level: L1
        required: false
        path: Gemfile
      - id: build.makefile
        type: file_exists
        name: Makefile
        pillar: build
        level: L1
        required: false
        path: Makefile

  - id: build.scripts
    name: Build scripts defined
    description: Build and test scripts are defined
    type: build_command_detect
    pillar: build
    level: L2
    required: false
    commands: ["build", "test"]
    files: ["package.json", "Makefile", "pyproject.toml", "setup.py", "Cargo.toml", "go.mod"]

  - id: build.lock_file
    name: Lock file exists
    description: Dependency lock file for reproducible builds
    type: any_of
    pillar: build
    level: L2
    required: false
    checks:
      - id: build.npm_lock
        type: file_exists
        name: npm lock
        pillar: build
        level: L2
        required: false
        path: package-lock.json
      - id: build.yarn_lock
        type: file_exists
        name: yarn lock
        pillar: build
        level: L2
        required: false
        path: yarn.lock
      - id: build.pnpm_lock
        type: file_exists
        name: pnpm lock
        pillar: build
        level: L2
        required: false
        path: pnpm-lock.yaml
      - id: build.cargo_lock
        type: file_exists
        name: Cargo.lock (Rust)
        pillar: build
        level: L2
        required: false
        path: Cargo.lock
      - id: build.go_sum
        type: file_exists
        name: go.sum (Go)
        pillar: build
        level: L2
        required: false
        path: go.sum
      - id: build.poetry_lock
        type: file_exists
        name: poetry.lock (Python)
        pillar: build
        level: L2
        required: false
        path: poetry.lock
      - id: build.pipfile_lock
        type: file_exists
        name: Pipfile.lock (Python)
        pillar: build
        level: L2
        required: false
        path: Pipfile.lock
      - id: build.gemfile_lock
        type: file_exists
        name: Gemfile.lock (Ruby)
        pillar: build
        level: L2
        required: false
        path: Gemfile.lock
      - id: build.uv_lock
        type: file_exists
        name: uv.lock (Python/uv)
        pillar: build
        level: L2
        required: false
        path: uv.lock
      - id: build.requirements_txt
        type: file_exists
        name: requirements.txt (Python)
        pillar: build
        level: L2
        required: false
        path: requirements.txt

  # =============================================================================
  # PILLAR: Testing (test)
  # =============================================================================

  - id: test.test_files
    name: Test files exist
    description: Project has test files
    type: any_of
    pillar: test
    level: L1
    required: false
    checks:
      - id: test.test_files_js
        type: path_glob
        name: JS/TS test files
        pillar: test
        level: L1
        required: false
        pattern: "**/*.{test,spec}.{js,ts,jsx,tsx}"
        min_matches: 1
      - id: test.test_files_py
        type: path_glob
        name: Python test files
        pillar: test
        level: L1
        required: false
        pattern: "**/test_*.py"
        min_matches: 1
      - id: test.test_files_py_alt
        type: path_glob
        name: Python test files (alt)
        pillar: test
        level: L1
        required: false
        pattern: "**/*_test.py"
        min_matches: 1
      - id: test.test_files_go
        type: path_glob
        name: Go test files
        pillar: test
        level: L1
        required: false
        pattern: "**/*_test.go"
        min_matches: 1
      - id: test.test_files_rust
        type: path_glob
        name: Rust test files
        pillar: test
        level: L1
        required: false
        pattern: "**/tests/**/*.rs"
        min_matches: 1
      - id: test.tests_directory
        type: path_glob
        name: Tests directory
        pillar: test
        level: L1
        required: false
        pattern: "tests/**/*"
        min_matches: 1

  - id: test.config
    name: Test configuration
    description: Test framework configuration exists
    type: any_of
    pillar: test
    level: L2
    required: false
    checks:
      - id: test.jest_config
        type: path_glob
        name: Jest config
        pillar: test
        level: L2
        required: false
        pattern: "jest.config.*"
      - id: test.vitest_config
        type: path_glob
        name: Vitest config
        pillar: test
        level: L2
        required: false
        pattern: "vitest.config.*"
      - id: test.mocha_config
        type: file_exists
        name: Mocha config
        pillar: test
        level: L2
        required: false
        path: .mocharc.json
      # Python test configs
      - id: test.pytest_ini
        type: file_exists
        name: pytest.ini (Python)
        pillar: test
        level: L2
        required: false
        path: pytest.ini
      - id: test.conftest
        type: file_exists
        name: conftest.py (pytest)
        pillar: test
        level: L2
        required: false
        path: conftest.py
      - id: test.setup_cfg_pytest
        type: file_exists
        name: setup.cfg (Python)
        pillar: test
        level: L2
        required: false
        path: setup.cfg
        content_regex: "(pytest|tool:pytest)"
      - id: test.tox_ini
        type: file_exists
        name: tox.ini (Python)
        pillar: test
        level: L2
        required: false
        path: tox.ini
      - id: test.pyproject_pytest
        type: file_exists
        name: pyproject.toml with pytest
        pillar: test
        level: L2
        required: false
        path: pyproject.toml
        content_regex: "(pytest|tool\\.pytest)"
      # Go test configs
      - id: test.go_test_main
        type: path_glob
        name: Go test main
        pillar: test
        level: L2
        required: false
        pattern: "**/*_test.go"
        min_matches: 1

  - id: test.integration_tests
    name: Integration tests
    description: Integration test files exist
    type: any_of
    pillar: test
    level: L3
    required: false
    checks:
      - id: test.integration_dir
        type: path_glob
        name: Integration test directory (JS/TS)
        pillar: test
        level: L3
        required: false
        pattern: "**/integration/**/*.{test,spec}.{js,ts,jsx,tsx}"
      - id: test.integration_files
        type: path_glob
        name: Integration test files (JS/TS)
        pillar: test
        level: L3
        required: false
        pattern: "**/*.integration.{test,spec}.{js,ts,jsx,tsx}"
      - id: test.integration_py
        type: path_glob
        name: Integration tests (Python)
        pillar: test
        level: L3
        required: false
        pattern: "**/integration/**/test_*.py"
      - id: test.integration_py_alt
        type: path_glob
        name: Integration tests (Python alt)
        pillar: test
        level: L3
        required: false
        pattern: "**/test_integration*.py"
      - id: test.integration_go
        type: path_glob
        name: Integration tests (Go)
        pillar: test
        level: L3
        required: false
        pattern: "**/*_integration_test.go"
      - id: test.integration_e2e
        type: path_glob
        name: E2E tests directory
        pillar: test
        level: L3
        required: false
        pattern: "**/e2e/**/*.{test,spec,py,go,rs}"

  # =============================================================================
  # PILLAR: Security (security)
  # =============================================================================

  - id: security.gitignore
    name: .gitignore exists
    description: Git ignore file to prevent committing sensitive files
    type: file_exists
    pillar: security
    level: L1
    required: true
    path: .gitignore

  - id: security.gitignore_secrets
    name: .gitignore covers secrets
    description: .gitignore includes common secret patterns
    type: file_exists
    pillar: security
    level: L2
    required: false
    path: .gitignore
    content_regex: "(\\.env|\\.secret|credentials)"

  - id: security.dependabot
    name: Dependabot configuration
    description: Automated dependency updates configured
    type: file_exists
    pillar: security
    level: L3
    required: false
    path: .github/dependabot.yml

  - id: security.codeowners
    name: CODEOWNERS file
    description: Code ownership defined for review routing
    type: any_of
    pillar: security
    level: L3
    required: false
    checks:
      - id: security.codeowners_github
        type: file_exists
        name: GitHub CODEOWNERS
        pillar: security
        level: L3
        required: false
        path: .github/CODEOWNERS
      - id: security.codeowners_root
        type: file_exists
        name: Root CODEOWNERS
        pillar: security
        level: L3
        required: false
        path: CODEOWNERS
      - id: security.codeowners_docs
        type: file_exists
        name: Docs CODEOWNERS
        pillar: security
        level: L3
        required: false
        path: docs/CODEOWNERS

  # =============================================================================
  # PILLAR: Observability (observability)
  # =============================================================================

  - id: observability.logging
    name: Logging framework
    description: Structured logging framework is used
    type: log_framework_detect
    pillar: observability
    level: L3
    required: false
    frameworks: ["winston", "pino", "bunyan", "log4js", "loguru", "structlog", "zap", "zerolog", "logrus", "tracing", "env_logger", "slog"]

  - id: observability.tracing
    name: Distributed tracing
    description: Distributed tracing instrumentation configured
    type: dependency_detect
    pillar: observability
    level: L4
    required: false
    applicableTo: [web-service, webapp]  # Not applicable to CLI or library projects
    packages:
      - "@opentelemetry/sdk-trace-node"
      - "@opentelemetry/api"
      - "dd-trace"
      - "jaeger-client"
      - "@sentry/tracing"
      - "opentelemetry-sdk"
      - "ddtrace"
    config_files:
      - "otel.config.js"
      - "tracing.js"
      - "instrumentation.js"

  - id: observability.metrics
    name: Metrics collection
    description: Application metrics instrumentation
    type: dependency_detect
    pillar: observability
    level: L4
    required: false
    applicableTo: [web-service, webapp]  # Not applicable to CLI or library projects
    packages:
      - "prom-client"
      - "statsd-client"
      - "@opentelemetry/sdk-metrics"
      - "hot-shots"
      - "prometheus_client"

  # =============================================================================
  # PILLAR: Environment (env)
  # =============================================================================

  - id: env.dotenv_example
    name: Environment example
    description: .env.example or similar template exists
    type: any_of
    pillar: env
    level: L2
    required: false
    checks:
      - id: env.dotenv_example.standard
        type: file_exists
        name: .env.example
        pillar: env
        level: L2
        required: false
        path: .env.example
      - id: env.dotenv_template
        type: file_exists
        name: .env.template
        pillar: env
        level: L2
        required: false
        path: .env.template

  - id: env.devcontainer
    name: Devcontainer configuration
    description: Development container configuration for consistent environments (Factory L2)
    type: any_of
    pillar: env
    level: L2
    required: false
    checks:
      - id: env.devcontainer_json
        type: file_exists
        name: Devcontainer config
        pillar: env
        level: L2
        required: false
        path: .devcontainer/devcontainer.json
      - id: env.devcontainer_dockerfile
        type: file_exists
        name: Devcontainer Dockerfile
        pillar: env
        level: L2
        required: false
        path: .devcontainer/Dockerfile

  - id: env.docker_compose
    name: Local services setup
    description: Docker Compose for local development services
    type: any_of
    pillar: env
    level: L3
    required: false
    applicableTo: [web-service, webapp, monorepo]  # Not typically needed for CLI or library
    checks:
      - id: env.docker_compose_yml
        type: file_exists
        name: docker-compose.yml
        pillar: env
        level: L3
        required: false
        path: docker-compose.yml
      - id: env.docker_compose_yaml
        type: file_exists
        name: docker-compose.yaml
        pillar: env
        level: L3
        required: false
        path: docker-compose.yaml
      - id: env.compose_yml
        type: file_exists
        name: compose.yml
        pillar: env
        level: L3
        required: false
        path: compose.yml

  # =============================================================================
  # Build System CI/CD Checks (merged into Build per Factory spec)
  # =============================================================================

  - id: build.github_workflow
    name: GitHub Actions workflow
    description: CI workflow exists for GitHub Actions
    type: path_glob
    pillar: build
    level: L1
    required: false
    pattern: ".github/workflows/*.{yml,yaml}"
    min_matches: 1

  - id: build.push_trigger
    name: CI triggers on push
    description: CI workflow runs on push events
    type: github_workflow_event
    pillar: build
    level: L2
    required: false
    event: push

  - id: build.pr_trigger
    name: CI triggers on PR
    description: CI workflow runs on pull request events
    type: github_workflow_event
    pillar: build
    level: L2
    required: false
    event: pull_request

  - id: build.checkout_action
    name: Uses checkout action
    description: Workflow uses actions/checkout
    type: github_action_present
    pillar: build
    level: L2
    required: false
    action: actions/checkout
    action_pattern: "actions/checkout@[\\w\\d\\.]+"

  # =============================================================================
  # PILLAR: Task Discovery (task_discovery)
  # =============================================================================

  - id: task_discovery.issue_templates
    name: Issue templates
    description: GitHub issue templates for structured bug reports and features
    type: any_of
    pillar: task_discovery
    level: L2
    required: false
    checks:
      - id: task_discovery.issue_template_dir
        type: path_glob
        name: Issue template directory
        pillar: task_discovery
        level: L2
        required: false
        pattern: ".github/ISSUE_TEMPLATE/*.{md,yml,yaml}"
      - id: task_discovery.issue_template_single
        type: file_exists
        name: Single issue template
        pillar: task_discovery
        level: L2
        required: false
        path: .github/ISSUE_TEMPLATE.md

  - id: task_discovery.pr_template
    name: Pull request template
    description: PR template for consistent contribution format
    type: any_of
    pillar: task_discovery
    level: L2
    required: false
    checks:
      - id: task_discovery.pr_template_github
        type: file_exists
        name: GitHub PR template
        pillar: task_discovery
        level: L2
        required: false
        path: .github/PULL_REQUEST_TEMPLATE.md
      - id: task_discovery.pr_template_github_lower
        type: file_exists
        name: GitHub PR template (lowercase)
        pillar: task_discovery
        level: L2
        required: false
        path: .github/pull_request_template.md
      - id: task_discovery.pr_template_root
        type: file_exists
        name: Root PR template
        pillar: task_discovery
        level: L2
        required: false
        path: PULL_REQUEST_TEMPLATE.md

  # =============================================================================
  # PILLAR: Product & Experimentation (product)
  # =============================================================================

  - id: product.feature_flags
    name: Feature flag configuration
    description: Feature flag system for controlled rollouts (for applications, not libraries)
    type: any_of
    pillar: product
    level: L4
    required: false
    applicableTo: [webapp, web-service]  # Not applicable to CLI or library projects
    checks:
      - id: product.launchdarkly
        type: dependency_detect
        name: LaunchDarkly SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "launchdarkly-node-server-sdk"
          - "@launchdarkly/node-server-sdk"
          - "launchdarkly-react-client-sdk"
      - id: product.unleash
        type: dependency_detect
        name: Unleash client
        pillar: product
        level: L4
        required: false
        packages:
          - "unleash-client"
          - "@unleash/proxy-client-react"
      - id: product.flagsmith
        type: dependency_detect
        name: Flagsmith SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "flagsmith"
          - "flagsmith-nodejs"
      - id: product.growthbook
        type: dependency_detect
        name: GrowthBook SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "@growthbook/growthbook"
          - "@growthbook/growthbook-react"
      - id: product.split
        type: dependency_detect
        name: Split.io SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "@splitsoftware/splitio"
          - "@splitsoftware/splitio-react"

  - id: product.analytics
    name: Analytics instrumentation
    description: Product analytics for user behavior tracking (for applications, not libraries)
    type: any_of
    pillar: product
    level: L4
    required: false
    applicableTo: [webapp, web-service]  # Not applicable to CLI or library projects
    checks:
      - id: product.segment
        type: dependency_detect
        name: Segment Analytics
        pillar: product
        level: L4
        required: false
        packages:
          - "analytics-node"
          - "@segment/analytics-node"
          - "@segment/analytics-next"
      - id: product.amplitude
        type: dependency_detect
        name: Amplitude SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "@amplitude/analytics-node"
          - "@amplitude/analytics-browser"
          - "amplitude-js"
      - id: product.mixpanel
        type: dependency_detect
        name: Mixpanel SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "mixpanel"
          - "mixpanel-browser"
      - id: product.posthog
        type: dependency_detect
        name: PostHog SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "posthog-node"
          - "posthog-js"
      - id: product.heap
        type: dependency_detect
        name: Heap Analytics
        pillar: product
        level: L4
        required: false
        packages:
          - "@heap/heap-node"
          - "heap-js"

  - id: product.ab_testing
    name: A/B testing infrastructure
    description: Experimentation framework for product changes
    type: any_of
    pillar: product
    level: L4
    required: false
    applicableTo: [webapp, web-service]  # Not applicable to CLI or library projects
    checks:
      - id: product.optimizely
        type: dependency_detect
        name: Optimizely SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "@optimizely/optimizely-sdk"
          - "@optimizely/react-sdk"
      - id: product.ab_growthbook
        type: dependency_detect
        name: GrowthBook A/B
        pillar: product
        level: L4
        required: false
        packages:
          - "@growthbook/growthbook"
      - id: product.statsig
        type: dependency_detect
        name: Statsig SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "statsig-node"
          - "statsig-react"
      - id: product.vwo
        type: dependency_detect
        name: VWO SDK
        pillar: product
        level: L4
        required: false
        packages:
          - "vwo-node-sdk"

  # =============================================================================
  # PILLAR: Agent Configuration (agent_config) - NEW in v0.0.2
  # The core differentiator: Agent Native configuration files
  # =============================================================================

  # L1 - Basic Agent Configuration (3 checks)
  - id: agent_config.agents_md
    name: AGENTS.md or CLAUDE.md exists
    description: AI agent instruction file for providing context to agents
    type: any_of
    pillar: agent_config
    level: L1
    required: false
    checks:
      - id: agent_config.agents_md.standard
        type: file_exists
        name: AGENTS.md
        pillar: agent_config
        level: L1
        required: false
        path: AGENTS.md
      - id: agent_config.agents_md.claude
        type: file_exists
        name: CLAUDE.md
        pillar: agent_config
        level: L1
        required: false
        path: CLAUDE.md
      - id: agent_config.agents_md.copilot
        type: file_exists
        name: GitHub Copilot instructions
        pillar: agent_config
        level: L1
        required: false
        path: .github/copilot-instructions.md

  - id: agent_config.gitignore_agent
    name: .gitignore covers agent caches
    description: .gitignore includes AI agent cache and temp directories
    type: file_exists
    pillar: agent_config
    level: L1
    required: false
    path: .gitignore
    content_regex: "(\\.claude|\\.cursor|\\.aider|\\.copilot)"

  - id: agent_config.basic_instructions
    name: Basic agent instructions exist
    description: Any form of agent instruction file exists
    type: any_of
    pillar: agent_config
    level: L1
    required: false
    checks:
      - id: agent_config.basic_instructions.agents
        type: file_exists
        name: AGENTS.md exists
        pillar: agent_config
        level: L1
        required: false
        path: AGENTS.md
      - id: agent_config.basic_instructions.claude
        type: file_exists
        name: CLAUDE.md exists
        pillar: agent_config
        level: L1
        required: false
        path: CLAUDE.md
      - id: agent_config.basic_instructions.cursorrules
        type: file_exists
        name: .cursorrules exists
        pillar: agent_config
        level: L1
        required: false
        path: .cursorrules

  # L2 - Structured Configuration (6 checks)
  - id: agent_config.claude_settings
    name: Claude Code settings
    description: .claude/settings.json or .claude/settings.local.json
    type: any_of
    pillar: agent_config
    level: L2
    required: false
    checks:
      - id: agent_config.claude_settings.json
        type: file_exists
        name: Claude settings.json
        pillar: agent_config
        level: L2
        required: false
        path: .claude/settings.json
      - id: agent_config.claude_settings.local
        type: file_exists
        name: Claude settings.local.json
        pillar: agent_config
        level: L2
        required: false
        path: .claude/settings.local.json

  - id: agent_config.claude_commands
    name: Claude custom commands
    description: Custom slash commands defined in .claude/commands/
    type: path_glob
    pillar: agent_config
    level: L2
    required: false
    pattern: ".claude/commands/*.md"
    min_matches: 1

  - id: agent_config.cursorrules
    name: Cursor rules configuration
    description: .cursorrules or .cursor/rules for Cursor AI IDE
    type: any_of
    pillar: agent_config
    level: L2
    required: false
    checks:
      - id: agent_config.cursorrules.root
        type: file_exists
        name: .cursorrules (root)
        pillar: agent_config
        level: L2
        required: false
        path: .cursorrules
      - id: agent_config.cursorrules.dir
        type: file_exists
        name: .cursor/rules
        pillar: agent_config
        level: L2
        required: false
        path: .cursor/rules

  - id: agent_config.aider_config
    name: Aider configuration
    description: .aider.conf.yml for Aider AI assistant
    type: any_of
    pillar: agent_config
    level: L2
    required: false
    checks:
      - id: agent_config.aider_config.yml
        type: file_exists
        name: .aider.conf.yml
        pillar: agent_config
        level: L2
        required: false
        path: .aider.conf.yml
      - id: agent_config.aider_config.yaml
        type: file_exists
        name: .aider.conf.yaml
        pillar: agent_config
        level: L2
        required: false
        path: .aider.conf.yaml
      - id: agent_config.aider_config.toml
        type: file_exists
        name: .aider.toml
        pillar: agent_config
        level: L2
        required: false
        path: .aider.toml

  - id: agent_config.copilot_config
    name: GitHub Copilot configuration
    description: Copilot instructions for GitHub Copilot
    type: any_of
    pillar: agent_config
    level: L2
    required: false
    checks:
      - id: agent_config.copilot_instructions
        type: file_exists
        name: copilot-instructions.md
        pillar: agent_config
        level: L2
        required: false
        path: .github/copilot-instructions.md
      - id: agent_config.copilot_prompts
        type: path_glob
        name: Copilot prompts directory
        pillar: agent_config
        level: L2
        required: false
        pattern: ".github/copilot/**/*.md"

  - id: agent_config.windsurf_rules
    name: Windsurf rules configuration
    description: .windsurfrules for Windsurf AI IDE
    type: file_exists
    pillar: agent_config
    level: L2
    required: false
    path: .windsurfrules

  # L3 - MCP Integration (4 checks)
  - id: agent_config.mcp_json
    name: MCP configuration exists
    description: mcp.json for Model Context Protocol server configuration
    type: any_of
    pillar: agent_config
    level: L3
    required: false
    checks:
      - id: agent_config.mcp_json.root
        type: file_exists
        name: mcp.json (root)
        pillar: agent_config
        level: L3
        required: false
        path: mcp.json
      - id: agent_config.mcp_json.claude
        type: file_exists
        name: .claude/mcp.json
        pillar: agent_config
        level: L3
        required: false
        path: .claude/mcp.json

  - id: agent_config.mcp_server_config
    name: MCP server implementation
    description: MCP server configuration or implementation exists
    type: any_of
    pillar: agent_config
    level: L3
    required: false
    checks:
      - id: agent_config.mcp_server_ts
        type: path_glob
        name: MCP server TypeScript
        pillar: agent_config
        level: L3
        required: false
        pattern: "**/mcp/**/*.ts"
        min_matches: 1
      - id: agent_config.mcp_server_py
        type: path_glob
        name: MCP server Python
        pillar: agent_config
        level: L3
        required: false
        pattern: "**/mcp/**/*.py"
        min_matches: 1
      - id: agent_config.mcp_package
        type: file_exists
        name: MCP in package.json
        pillar: agent_config
        level: L3
        required: false
        path: package.json
        content_regex: "@modelcontextprotocol"

  - id: agent_config.mcp_tools_defined
    name: MCP tools defined
    description: At least one MCP tool is defined
    type: any_of
    pillar: agent_config
    level: L3
    required: false
    checks:
      - id: agent_config.mcp_tools_json
        type: file_exists
        name: Tools in mcp.json
        pillar: agent_config
        level: L3
        required: false
        path: mcp.json
        content_regex: "(tools|server\\.tool)"
      - id: agent_config.mcp_tools_code
        type: path_glob
        name: Tool implementations
        pillar: agent_config
        level: L3
        required: false
        pattern: "**/tools/*.ts"
        min_matches: 1

  - id: agent_config.claude_hooks
    name: Claude hooks configured
    description: .claude/hooks/ directory with automation hooks
    type: path_glob
    pillar: agent_config
    level: L3
    required: false
    pattern: ".claude/hooks/*"
    min_matches: 1

  # L4 - Advanced Automation (3 checks)
  - id: agent_config.multi_agent_support
    name: Multi-agent collaboration support
    description: Configuration for multiple AI agents working together
    type: any_of
    pillar: agent_config
    level: L4
    required: false
    checks:
      - id: agent_config.multi_agent_workflow
        type: file_exists
        name: Agent workflow config
        pillar: agent_config
        level: L4
        required: false
        path: .agent-workflows.yml
      - id: agent_config.agent_team
        type: path_glob
        name: Agent team definitions
        pillar: agent_config
        level: L4
        required: false
        pattern: ".agents/**/*.{yml,yaml,json}"
        min_matches: 1
      - id: agent_config.claude_multi
        type: file_exists
        name: Claude multi-agent config
        pillar: agent_config
        level: L4
        required: false
        path: .claude/agents.json

  - id: agent_config.context_injection
    name: Automatic context injection
    description: System for automatically providing context to agents
    type: any_of
    pillar: agent_config
    level: L4
    required: false
    checks:
      - id: agent_config.context_files
        type: path_glob
        name: Context injection files
        pillar: agent_config
        level: L4
        required: false
        pattern: ".context/**/*"
        min_matches: 1
      - id: agent_config.claude_context
        type: file_exists
        name: Claude context config
        pillar: agent_config
        level: L4
        required: false
        path: .claude/context.json
      - id: agent_config.rag_config
        type: file_exists
        name: RAG configuration
        pillar: agent_config
        level: L4
        required: false
        path: .rag-config.yml

  - id: agent_config.agent_permissions
    name: Agent permission boundaries
    description: Defined permission and capability boundaries for agents
    type: any_of
    pillar: agent_config
    level: L4
    required: false
    checks:
      - id: agent_config.claude_permissions
        type: file_exists
        name: Claude permissions config
        pillar: agent_config
        level: L4
        required: false
        path: .claude/settings.json
        content_regex: "(permissions|allowedTools|blockedTools)"
      - id: agent_config.agent_policy
        type: file_exists
        name: Agent policy file
        pillar: agent_config
        level: L4
        required: false
        path: .agent-policy.yml

  # L5 - Autonomous Agent (2 checks)
  - id: agent_config.autonomous_workflow
    name: Autonomous workflow definition
    description: Workflows that agents can execute without human intervention
    type: any_of
    pillar: agent_config
    level: L5
    required: false
    checks:
      - id: agent_config.auto_workflow_yml
        type: file_exists
        name: Autonomous workflow YAML
        pillar: agent_config
        level: L5
        required: false
        path: .agent-workflows/autonomous.yml
      - id: agent_config.auto_workflow_json
        type: file_exists
        name: Autonomous workflow JSON
        pillar: agent_config
        level: L5
        required: false
        path: .agent-workflows/autonomous.json
      - id: agent_config.claude_auto
        type: file_exists
        name: Claude autonomous config
        pillar: agent_config
        level: L5
        required: false
        path: .claude/autonomous.json

  - id: agent_config.self_improvement
    name: Self-improvement mechanism
    description: Agent can learn from feedback and improve its behavior
    type: any_of
    pillar: agent_config
    level: L5
    required: false
    checks:
      - id: agent_config.feedback_loop
        type: file_exists
        name: Feedback loop config
        pillar: agent_config
        level: L5
        required: false
        path: .agent-feedback.yml
      - id: agent_config.learning_config
        type: path_glob
        name: Agent learning configuration
        pillar: agent_config
        level: L5
        required: false
        pattern: ".agent-learning/**/*"
        min_matches: 1

  # =============================================================================
  # L5 CHECKS FOR EXISTING PILLARS (added in v0.0.2)
  # =============================================================================

  # docs.L5 - Auto-generated documentation
  - id: docs.auto_generated_docs
    name: Auto-generated documentation
    description: Documentation is automatically generated from code (Sphinx, TSDoc, JSDoc, etc.)
    type: any_of
    pillar: docs
    level: L5
    required: false
    checks:
      - id: docs.auto_generated_sphinx
        type: file_exists
        name: Sphinx configuration
        pillar: docs
        level: L5
        required: false
        path: docs/conf.py
      - id: docs.auto_generated_typedoc
        type: file_exists
        name: TypeDoc configuration
        pillar: docs
        level: L5
        required: false
        path: typedoc.json
      - id: docs.auto_generated_jsdoc
        type: file_exists
        name: JSDoc configuration
        pillar: docs
        level: L5
        required: false
        path: jsdoc.json
      - id: docs.auto_generated_mkdocs
        type: file_exists
        name: MkDocs configuration
        pillar: docs
        level: L5
        required: false
        path: mkdocs.yml
      - id: docs.auto_generated_docusaurus
        type: file_exists
        name: Docusaurus configuration
        pillar: docs
        level: L5
        required: false
        path: docusaurus.config.js

  - id: docs.docs_as_code
    name: Docs-as-code workflow
    description: Documentation updates are automated via CI/CD
    type: any_of
    pillar: docs
    level: L5
    required: false
    checks:
      - id: docs.docs_as_code_workflow
        type: path_glob
        name: Docs workflow
        pillar: docs
        level: L5
        required: false
        pattern: ".github/workflows/*docs*.{yml,yaml}"
        min_matches: 1
      - id: docs.docs_as_code_action
        type: path_glob
        name: Docs in CI
        pillar: docs
        level: L5
        required: false
        pattern: ".github/workflows/*.{yml,yaml}"
        content_regex: "(typedoc|jsdoc|sphinx-build|mkdocs)"

  # test.L5 - Advanced testing
  - id: test.mutation_testing
    name: Mutation testing
    description: Mutation testing to verify test effectiveness (Stryker, mutmut)
    type: any_of
    pillar: test
    level: L5
    required: false
    checks:
      - id: test.mutation_stryker
        type: file_exists
        name: Stryker config
        pillar: test
        level: L5
        required: false
        path: stryker.conf.js
      - id: test.mutation_stryker_json
        type: file_exists
        name: Stryker JSON config
        pillar: test
        level: L5
        required: false
        path: stryker.conf.json
      - id: test.mutation_mutmut
        type: file_exists
        name: mutmut config
        pillar: test
        level: L5
        required: false
        path: pyproject.toml
        content_regex: "\\[tool\\.mutmut\\]"
      - id: test.mutation_package
        type: file_exists
        name: Stryker in package.json
        pillar: test
        level: L5
        required: false
        path: package.json
        content_regex: "@stryker-mutator"

  - id: test.property_based_testing
    name: Property-based testing
    description: Property-based tests using fast-check, Hypothesis, etc.
    type: any_of
    pillar: test
    level: L5
    required: false
    checks:
      - id: test.property_fastcheck
        type: file_exists
        name: fast-check in dependencies
        pillar: test
        level: L5
        required: false
        path: package.json
        content_regex: "fast-check"
      - id: test.property_hypothesis
        type: file_exists
        name: Hypothesis in Python
        pillar: test
        level: L5
        required: false
        path: pyproject.toml
        content_regex: "hypothesis"
      - id: test.property_files
        type: path_glob
        name: Property test files
        pillar: test
        level: L5
        required: false
        pattern: "**/*.property.{test,spec}.{ts,js}"
        min_matches: 1

  # security.L5 - Advanced security
  - id: security.sast_integrated
    name: SAST in CI
    description: Static Application Security Testing integrated into CI (CodeQL, Semgrep)
    type: any_of
    pillar: security
    level: L5
    required: false
    checks:
      - id: security.sast_codeql
        type: file_exists
        name: CodeQL workflow
        pillar: security
        level: L5
        required: false
        path: .github/workflows/codeql-analysis.yml
      - id: security.sast_codeql_alt
        type: file_exists
        name: CodeQL workflow (alt)
        pillar: security
        level: L5
        required: false
        path: .github/workflows/codeql.yml
      - id: security.sast_semgrep
        type: file_exists
        name: Semgrep config
        pillar: security
        level: L5
        required: false
        path: .semgrep.yml
      - id: security.sast_snyk
        type: file_exists
        name: Snyk config
        pillar: security
        level: L5
        required: false
        path: .snyk

  - id: security.sbom_generation
    name: SBOM generation
    description: Software Bill of Materials automatically generated
    type: any_of
    pillar: security
    level: L5
    required: false
    checks:
      - id: security.sbom_cyclonedx
        type: path_glob
        name: CycloneDX SBOM
        pillar: security
        level: L5
        required: false
        pattern: "**/sbom*.{json,xml}"
        min_matches: 1
      - id: security.sbom_workflow
        type: path_glob
        name: SBOM workflow
        pillar: security
        level: L5
        required: false
        pattern: ".github/workflows/*.{yml,yaml}"
        content_regex: "(sbom|cyclonedx|syft)"

  # build.L5 - Advanced deployment
  - id: build.canary_deployment
    name: Canary deployment
    description: Canary or blue-green deployment configuration
    type: any_of
    pillar: build
    level: L5
    required: false
    applicableTo: [web-service]  # Only applicable to deployed web services
    checks:
      - id: build.canary_k8s
        type: path_glob
        name: Kubernetes canary config
        pillar: build
        level: L5
        required: false
        pattern: "**/k8s/**/*canary*.{yml,yaml}"
        min_matches: 1
      - id: build.canary_argo
        type: file_exists
        name: Argo Rollouts config
        pillar: build
        level: L5
        required: false
        path: argo-rollouts.yml
      - id: build.canary_flagger
        type: path_glob
        name: Flagger canary
        pillar: build
        level: L5
        required: false
        pattern: "**/flagger*.{yml,yaml}"
        min_matches: 1

  - id: build.rollback_automation
    name: Automated rollback
    description: Automatic rollback mechanism on failure
    type: any_of
    pillar: build
    level: L5
    required: false
    applicableTo: [web-service]  # Only applicable to deployed web services
    checks:
      - id: build.rollback_workflow
        type: path_glob
        name: Rollback workflow
        pillar: build
        level: L5
        required: false
        pattern: ".github/workflows/*rollback*.{yml,yaml}"
        min_matches: 1
      - id: build.rollback_script
        type: file_exists
        name: Rollback script
        pillar: build
        level: L5
        required: false
        path: scripts/rollback.sh

  # =============================================================================
  # NEW IN v0.0.3: Documentation Freshness Check
  # =============================================================================

  - id: docs.readme_freshness
    name: README freshness
    description: README has been updated within the last 180 days
    type: git_freshness
    pillar: docs
    level: L3
    required: false
    path: README.md
    max_days: 180

  - id: docs.agents_md_freshness
    name: AGENTS.md freshness
    description: AGENTS.md has been updated within the last 90 days
    type: git_freshness
    pillar: docs
    level: L3
    required: false
    path: AGENTS.md
    max_days: 90

  # =============================================================================
  # NEW IN v0.0.3: VCS CLI Tools Detection
  # =============================================================================

  - id: build.vcs_cli_tools
    name: VCS CLI tools available
    description: GitHub CLI (gh) or other VCS CLI tools are available
    type: command_exists
    pillar: build
    level: L2
    required: false
    commands: ["gh", "git-lfs", "hub"]
    require_all: false

  # =============================================================================
  # NEW IN v0.0.3: Code Quality Pillar
  # =============================================================================

  - id: code_quality.complexity_config
    name: Code complexity analysis configured
    description: Code complexity or quality analysis tool configured
    type: any_of
    pillar: code_quality
    level: L2
    required: false
    checks:
      - id: code_quality.codeclimate
        type: file_exists
        name: CodeClimate config
        pillar: code_quality
        level: L2
        required: false
        path: .codeclimate.yml
      - id: code_quality.sonar
        type: file_exists
        name: SonarQube config
        pillar: code_quality
        level: L2
        required: false
        path: sonar-project.properties
      - id: code_quality.sonar_json
        type: file_exists
        name: SonarCloud config
        pillar: code_quality
        level: L2
        required: false
        path: sonar-project.json

  - id: code_quality.coverage_config
    name: Code coverage configured
    description: Test coverage reporting is configured
    type: any_of
    pillar: code_quality
    level: L2
    required: false
    checks:
      - id: code_quality.codecov
        type: file_exists
        name: Codecov config
        pillar: code_quality
        level: L2
        required: false
        path: codecov.yml
      - id: code_quality.codecov_yaml
        type: file_exists
        name: Codecov config (yaml)
        pillar: code_quality
        level: L2
        required: false
        path: .codecov.yml
      - id: code_quality.coveralls
        type: file_exists
        name: Coveralls config
        pillar: code_quality
        level: L2
        required: false
        path: .coveralls.yml
      - id: code_quality.jest_coverage
        type: file_exists
        name: Jest coverage in package.json
        pillar: code_quality
        level: L2
        required: false
        path: package.json
        content_regex: "coverageThreshold"
      - id: code_quality.nyc_config
        type: file_exists
        name: nyc/istanbul coverage config
        pillar: code_quality
        level: L2
        required: false
        path: .nycrc

  - id: code_quality.duplication_detection
    name: Code duplication detection
    description: Tool for detecting duplicate code configured
    type: any_of
    pillar: code_quality
    level: L3
    required: false
    checks:
      - id: code_quality.jscpd
        type: file_exists
        name: jscpd config
        pillar: code_quality
        level: L3
        required: false
        path: .jscpd.json
      - id: code_quality.cpd_config
        type: path_glob
        name: CPD/PMD duplication config
        pillar: code_quality
        level: L3
        required: false
        pattern: "**/pmd*.xml"
        min_matches: 1

  - id: code_quality.tech_debt_tracking
    name: Technical debt tracking
    description: Technical debt is tracked via TODO comments or tools
    type: any_of
    pillar: code_quality
    level: L4
    required: false
    checks:
      - id: code_quality.todo_config
        type: file_exists
        name: TODO/FIXME tracking config
        pillar: code_quality
        level: L4
        required: false
        path: .todo
      - id: code_quality.technical_debt_md
        type: file_exists
        name: Technical debt documentation
        pillar: code_quality
        level: L4
        required: false
        path: TECHNICAL_DEBT.md

  # =============================================================================
  # SPEC-DRIVEN DEVELOPMENT (spec-kit integration)
  # https://github.com/github/spec-kit
  # =============================================================================

  - id: docs.spec_constitution
    name: Project constitution
    description: CONSTITUTION.md defines project principles and development guidelines
    type: file_exists
    pillar: docs
    level: L3
    required: false
    path: CONSTITUTION.md

  - id: docs.spec_md
    name: Feature specification
    description: SPEC.md or specs/ directory with feature specifications
    type: any_of
    pillar: docs
    level: L3
    required: false
    checks:
      - id: docs.spec_md_root
        type: file_exists
        name: Root SPEC.md
        pillar: docs
        level: L3
        required: false
        path: SPEC.md
      - id: docs.spec_directory
        type: path_glob
        name: Feature specs directory
        pillar: docs
        level: L3
        required: false
        pattern: "specs/**/spec.md"
        min_matches: 1

  - id: docs.spec_plans
    name: Implementation plans
    description: Technical implementation plans (plan.md or PLAN.md)
    type: any_of
    pillar: docs
    level: L4
    required: false
    checks:
      - id: docs.plan_md_root
        type: file_exists
        name: Root PLAN.md
        pillar: docs
        level: L4
        required: false
        path: PLAN.md
      - id: docs.plan_directory
        type: path_glob
        name: Feature plans in specs/
        pillar: docs
        level: L4
        required: false
        pattern: "specs/**/plan.md"
        min_matches: 1

  - id: docs.spec_contracts_openapi
    name: OpenAPI contracts
    description: API contracts defined using OpenAPI/Swagger specification
    type: any_of
    pillar: docs
    level: L4
    required: false
    checks:
      - id: docs.openapi_root
        type: file_exists
        name: Root openapi.yaml
        pillar: docs
        level: L4
        required: false
        path: openapi.yaml
      - id: docs.openapi_yml
        type: file_exists
        name: Root openapi.yml
        pillar: docs
        level: L4
        required: false
        path: openapi.yml
      - id: docs.openapi_json
        type: file_exists
        name: Root openapi.json
        pillar: docs
        level: L4
        required: false
        path: openapi.json
      - id: docs.swagger_yaml
        type: file_exists
        name: Root swagger.yaml
        pillar: docs
        level: L4
        required: false
        path: swagger.yaml
      - id: docs.swagger_json
        type: file_exists
        name: Root swagger.json
        pillar: docs
        level: L4
        required: false
        path: swagger.json
      - id: docs.openapi_spec_dir
        type: path_glob
        name: OpenAPI in spec/ or api/
        pillar: docs
        level: L4
        required: false
        pattern: "{spec,api,contracts,specs}/**/*.{yaml,yml,json}"
        min_matches: 1
        content_regex: "(openapi|swagger)"
      - id: docs.openapi_docs_dir
        type: path_glob
        name: OpenAPI in docs/
        pillar: docs
        level: L4
        required: false
        pattern: "docs/**/*.{yaml,yml,json}"
        min_matches: 1
        content_regex: "(openapi|swagger)"

  - id: docs.spec_tasks
    name: Task specifications
    description: Task lists derived from specs (tasks.md or TASKS.md)
    type: any_of
    pillar: docs
    level: L3
    required: false
    checks:
      - id: docs.tasks_md_root
        type: file_exists
        name: Root TASKS.md
        pillar: docs
        level: L3
        required: false
        path: TASKS.md
      - id: docs.tasks_directory
        type: path_glob
        name: Feature tasks in specs/
        pillar: docs
        level: L3
        required: false
        pattern: "specs/**/tasks.md"
        min_matches: 1

  - id: agent_config.speckit_commands
    name: Spec-kit commands
    description: Spec-kit slash commands for AI agents (/speckit.* commands)
    type: path_glob
    pillar: agent_config
    level: L3
    required: false
    pattern: ".claude/commands/speckit*.md"
    min_matches: 1

  # =============================================================================
  # AGENT CONTROL SURFACE - Agent-Driven Development
  # These checks verify production control mechanisms for safe agent collaboration
  # =============================================================================

  # ---------------------------------------------------------------------------
  # Agent Boundaries (L3) - Define what agents CAN and CANNOT modify
  # ---------------------------------------------------------------------------

  - id: agent_config.agent_boundaries
    name: Agent boundaries defined
    description: Explicit boundaries for what agents can modify
    type: any_of
    pillar: agent_config
    level: L3
    required: false
    checks:
      - id: agent_config.boundaries_json
        type: file_exists
        name: Agent boundaries JSON
        pillar: agent_config
        level: L3
        required: false
        path: .claude/boundaries.json
      - id: agent_config.boundaries_yaml
        type: file_exists
        name: Agent boundaries YAML
        pillar: agent_config
        level: L3
        required: false
        path: .agent-boundaries.yml
      - id: agent_config.codeowners_agents
        type: file_exists
        name: CODEOWNERS with agent assignments
        pillar: agent_config
        level: L3
        required: false
        path: .github/CODEOWNERS
        content_regex: "(agent|bot|automated)"
        case_sensitive: false

  # ---------------------------------------------------------------------------
  # Task Discovery (L3) - How agents find work to do
  # ---------------------------------------------------------------------------

  - id: task_discovery.task_queue
    name: Task queue for agents
    description: Structured task list agents can claim and work on
    type: any_of
    pillar: task_discovery
    level: L3
    required: false
    checks:
      - id: task_discovery.tasks_md
        type: file_exists
        name: TASKS.md file
        pillar: task_discovery
        level: L3
        required: false
        path: TASKS.md
      - id: task_discovery.tasks_yaml
        type: file_exists
        name: tasks.yaml file
        pillar: task_discovery
        level: L3
        required: false
        path: tasks.yaml
      - id: task_discovery.github_issues_template
        type: path_glob
        name: GitHub issue templates for agent tasks
        pillar: task_discovery
        level: L3
        required: false
        pattern: ".github/ISSUE_TEMPLATE/*agent*.{md,yml,yaml}"
        min_matches: 1

  # ---------------------------------------------------------------------------
  # Verification Gates (L4) - CI must block bad agent changes
  # ---------------------------------------------------------------------------

  - id: build.ci_required_checks
    name: CI required status checks
    description: CI enforces quality gates before merge
    type: any_of
    pillar: build
    level: L4
    required: false
    checks:
      - id: build.branch_protection
        type: file_exists
        name: Branch protection rules
        pillar: build
        level: L4
        required: false
        path: .github/branch-protection.yml
      - id: build.ci_required_in_workflow
        type: path_glob
        name: CI workflow with required checks
        pillar: build
        level: L4
        required: false
        pattern: ".github/workflows/*.{yml,yaml}"
        min_matches: 1
        content_regex: "(required|if: failure|if: always)"

  - id: test.contract_tests
    name: Contract tests exist
    description: Tests that verify API/interface contracts
    type: any_of
    pillar: test
    level: L4
    required: false
    checks:
      - id: test.contract_test_files
        type: path_glob
        name: Contract test files
        pillar: test
        level: L4
        required: false
        pattern: "**/*.contract.{test,spec}.{ts,tsx,js,jsx}"
        min_matches: 1
      - id: test.contract_test_dir
        type: path_glob
        name: Contract test directory
        pillar: test
        level: L4
        required: false
        pattern: "{test,tests,__tests__}/contract/**/*.{ts,tsx,js,jsx}"
        min_matches: 1
      - id: test.pact_config
        type: file_exists
        name: Pact contract testing
        pillar: test
        level: L4
        required: false
        path: pact.config.js

  # ---------------------------------------------------------------------------
  # Frozen Contracts (L4) - Interfaces agents cannot modify
  # ---------------------------------------------------------------------------

  - id: docs.frozen_contracts
    name: Frozen contract definitions
    description: Explicitly marked interfaces that must not change
    type: any_of
    pillar: docs
    level: L4
    required: false
    checks:
      - id: docs.contracts_dir
        type: path_glob
        name: Contracts directory
        pillar: docs
        level: L4
        required: false
        pattern: "{contracts,frozen,schemas}/**/*.{ts,json,yaml}"
        min_matches: 1
      - id: docs.api_schema
        type: path_glob
        name: API schema definitions
        pillar: docs
        level: L4
        required: false
        pattern: "{api,spec}/**/*.schema.{json,yaml}"
        min_matches: 1

  # ---------------------------------------------------------------------------
  # Agent Coordination (L5) - Multi-agent collaboration
  # ---------------------------------------------------------------------------

  - id: agent_config.ownership_map
    name: Code ownership mapping
    description: Clear ownership of code areas for agent coordination
    type: any_of
    pillar: agent_config
    level: L5
    required: false
    checks:
      - id: agent_config.ownership_json
        type: file_exists
        name: Agent ownership JSON
        pillar: agent_config
        level: L5
        required: false
        path: .agent-ownership.json
      - id: agent_config.ownership_yaml
        type: file_exists
        name: Agent ownership YAML
        pillar: agent_config
        level: L5
        required: false
        path: .agent-ownership.yml
      - id: agent_config.agents_md
        type: file_exists
        name: AGENTS.md with ownership
        pillar: agent_config
        level: L5
        required: false
        path: AGENTS.md
        content_regex: "(owner|responsibility|boundary)"
        case_sensitive: false

  - id: agent_config.conflict_detection
    name: Agent conflict detection
    description: Mechanisms to detect and resolve agent conflicts
    type: any_of
    pillar: agent_config
    level: L5
    required: false
    checks:
      - id: agent_config.lock_config
        type: file_exists
        name: Agent lock configuration
        pillar: agent_config
        level: L5
        required: false
        path: .agent-locks.json
      - id: agent_config.conflict_workflow
        type: path_glob
        name: Conflict resolution workflow
        pillar: agent_config
        level: L5
        required: false
        pattern: ".github/workflows/*conflict*.{yml,yaml}"
        min_matches: 1

